# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

立法委員質詢統計視覺化網頁 (Legislator Statistics Web) - A Vue 3 + Vite single-page application that visualizes statistics on legislators' questioning activities in Taiwan's Legislative Yuan.

This is the **web frontend** of a multi-repo project that includes:
- **legislationAgencyCrawler**: Crawls meeting data from Legislative Yuan iVod system (Playwright-based)
- **legislationAgencyData**: Shared data storage directory
- **legislationAgencyAnalytics**: Generates speech statistics from raw meeting data
- **legislationAgencyWeb**: This repository - web visualization frontend

## Development Commands

### Essential Commands
```bash
npm run dev        # Start dev server at http://localhost:3000
npm run build      # Build for production
npm run preview    # Preview production build
```

### Data Pipeline (External Dependencies)
The web app depends on data generated by sibling repositories:

```bash
# Generate aggregated statistics (run from parent or analytics repo)
python ../legislationAgencyAnalytics/run_speech_stat.py

# Update raw data from Legislative Yuan (run from crawler repo)
cd ../legislationAgencyCrawler && make crawl
```

## Architecture

### Tech Stack
- **Vue 3** with Composition API (`<script setup>`)
- **Vite** for build tooling
- Single-page application with no routing
- Vanilla CSS styling (no frameworks)

### Code Structure
```
src/
├── App.vue       # Main application component (210 lines)
├── main.js       # Vue app initialization
└── style.css     # Global styles
public/
└── data/         # Static JSON data files (for runtime)
    ├── aggregated.json    # Pre-computed statistics per legislator
    └── committees.json    # Committee metadata
```

### Data Flow

**App.vue** is the single component that:
1. Fetches data from `/data/aggregated.json` and `/data/committees.json` on mount
2. Provides interactive filtering by committee (checkboxes)
3. Computes filtered statistics reactively using Vue computed properties
4. Displays sortable table with legislators' speech counts and durations
5. Shows summary statistics (total legislators, speeches, duration)

**Data Structure** (`aggregated.json`):
```json
{
  "立委姓名": {
    "committees": {
      "委員會ID": {
        "count": 123,      // Number of speeches
        "duration": 4567   // Total duration in seconds
      }
    }
  }
}
```

**Filtering Logic**:
- User selects committees via checkboxes
- App filters each legislator's committee data
- Only includes legislators with speeches in selected committees
- Recalculates totals and rankings dynamically

**Sorting**:
- Click table headers to sort by that column
- Supports: rank, speaker name, total speeches, total duration, avg duration
- Toggles between ascending/descending order
- Chinese name sorting uses `localeCompare('zh-TW')`

### Key Implementation Details

**Duration Formatting** (src/App.vue:195-205):
- Formats seconds into `HH:MM:SS` or `MM:SS`
- Pads minutes/seconds with leading zeros

**Committee Display** (src/App.vue:118-121):
- Joins committee names with Chinese enumeration comma (、)
- Strips "委員會" suffix for brevity

**Reactive Computation** (src/App.vue:96-153):
- `filteredStats` computed property handles all filtering, sorting, ranking
- `totalSpeeches` and `totalDuration` derived from filtered data
- Changes to `selectedCommittees` or sort parameters trigger automatic recalculation

## Project Context

### Related Skill
This repo has a Claude Code skill for analyzing legislator questioning transcripts:
- `.claude/skills/legislator_question_analysis/SKILL.md`
- Analyzes questioning quality, attitude, and official responses
- Outputs structured summaries with scoring (-2 to +2)

### Data Dependencies
The web app displays **pre-aggregated statistics**. To update data:

1. Raw meeting data must exist (crawled by legislationAgencyCrawler)
2. Statistics must be generated by `legislationAgencyAnalytics`
3. Results are copied to `public/data/aggregated.json`
4. Committee metadata: `public/data/committees.json` provides shared configuration

The aggregation script path referenced in `package.json` (`aggregate_stats.py`) points to the analytics repo but should be run from there, not this repo.

## Configuration

**Vite Config** (vite.config.js):
- Uses `@vitejs/plugin-vue`
- Base path set to `'./'` for relative asset paths (supports deployment to subdirectories)
- Dev server on port 3000

**No build-time dependencies** on the data pipeline - the app simply fetches JSON from public directory at runtime.
